!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.xstate=e():t.xstate=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,n){"use strict";function i(t){try{return"string"==typeof t||"number"==typeof t?""+t:t.type}catch(t){throw new Error("Events must be strings or objects with a string event.type property.")}}function r(t,e){try{return Array.isArray(t)?t:t.toString().split(e)}catch(e){throw new Error("'"+t+"' is not a valid state path.")}}function a(t,e){return t instanceof p?t.value:"object"!=typeof t||t instanceof p?o(r(t,e)):t}function o(t){if(1===t.length)return t[0];for(var e={},n=e,i=0;i<t.length-1;i++)i===t.length-2?n[t[i]]=t[i+1]:(n[t[i]]={},n=n[t[i]]);return e}function s(t,e){var n={};return Object.keys(t).forEach(function(i){n[i]=e(t[i],i,t)}),n}function c(t,e,n){void 0===n&&(n=l);var i=a(t,n),r=a(e,n);return"string"==typeof r?"string"==typeof i&&r===i:"string"==typeof i?i in r:Object.keys(i).every(function(t){return t in r&&c(i[t],r[t])})}function u(t,e){var n;return Object.keys(t).forEach(function(t){c(t,e)&&(!n||e.length>n.length)&&(n=t)}),t[n]}function f(t){return new I(t)}Object.defineProperty(e,"__esModule",{value:!0});var h={};n.d(h,"actionTypes",function(){return E}),n.d(h,"toEventObject",function(){return m}),n.d(h,"toActionObject",function(){return S}),n.d(h,"toActionObjects",function(){return x}),n.d(h,"raise",function(){return w}),n.d(h,"send",function(){return j}),n.d(h,"cancel",function(){return O}),n.d(h,"start",function(){return k}),n.d(h,"stop",function(){return P});var l=".",v={},p=function(){function t(t,e,n,i,r,a){void 0===n&&(n=[]),void 0===i&&(i=v),void 0===r&&(r={}),void 0===a&&(a=[]),this.value=t,this.history=e,this.actions=n,this.activities=i,this.data=r,this.events=a}return t.from=function(e){return e instanceof t?e:new t(e)},t.inert=function(e){return e instanceof t?e.actions.length?new t(e.value,e.history,[]):e:t.from(e)},t.prototype.toString=function(){if("string"==typeof this.value)return this.value;for(var t=[],e=this.value;;){if("string"==typeof e){t.push(e);break}var n=Object.keys(e),i=n[0];if(n.slice(1).length)return;t.push(i),e=e[i]}return t.join(l)},t}(),d=function(t){return function(e){for(var n=e,i=0,r=t;i<r.length;i++){n=n[r[i]]}return n}},y=function(t){return"string"==typeof t?[[t]]:Object.keys(t).map(function(e){return y(t[e]).map(function(t){return[e].concat(t)})}).reduce(function(t,e){return t.concat(e)},[])},g=function(t){var e={};if(t&&1===t.length&&1===t[0].length)return t[0][0];for(var n=0,i=t;n<i.length;n++)for(var r=i[n],a=e,o=0;o<r.length;o++){var s=r[o];if(o===r.length-2){a[s]=r[o+1];break}a[s]=a[s]||{},a=a[s]}return e},E={start:"xstate.start",stop:"xstate.stop",raise:"xstate.raise",send:"xstate.send",cancel:"xstate.cancel",null:"xstate.null"},b=function(t){return function(e){var n="string"==typeof e||"number"==typeof e?{type:e}:e;return{type:t,activity:i(e),data:n}}},m=function(t){return"string"==typeof t||"number"==typeof t?{type:t}:t},S=function(t){var e;if("string"==typeof t||"number"==typeof t)e={type:t};else{if("function"!=typeof t)return t;e={type:t.name}}return Object.defineProperty(e,"toString",{value:function(){return e.type}}),e},x=function(t){return t?(Array.isArray(t)?t:[t]).map(S):[]},w=function(t){return{type:E.raise,event:t}},j=function(t,e){return{type:E.send,event:m(t),delay:e?e.delay:void 0,id:e&&void 0!==e.id?e.id:i(t)}},O=function(t){return{type:E.cancel,sendId:t}},k=b(E.start),P=b(E.stop),N=this&&this.__assign||Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},_=".",V=function(t){return"#"===t[0]},A=Object.freeze({onEntry:[],onExit:[],actions:[]}),M=function(t){for(;t.parent&&!t.parent.parallel;)t=t.parent;return t},T=function(t,e,n,i){var r=M(i),a=r.parent,o=a?a.id:"";if(n[o]=n[o]||{},n[o][r.id]&&n[o][r.id]!==i)throw new Error("Event '"+e+"' on state '"+t.id+"' leads to an invalid configuration: Two or more states in the orthogonal region '"+r.id+"'.");return n[o][r.id]=i,r},I=function(){function t(e){var n=this;this.config=e,this.__cache={events:void 0,relativeValue:new Map,initialState:void 0},this.idMap={},this.key=e.key||"(machine)",this.parent=e.parent,this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=e.delimiter||(this.parent?this.parent.delimiter:_),this.id=e.id||(this.machine?[this.machine.key].concat(this.path).join(this.delimiter):this.key),this.initial=e.initial,this.parallel=!!e.parallel,this.states=e.states?s(e.states,function(e,i){var r=new t(N({},e,{key:i,parent:n}));return Object.assign(n.idMap,N((a={},a[r.id]=r,a),r.idMap)),r;var a}):{},this.on=e.on?this.formatTransitions(e.on):{},this.strict=!!e.strict,this.onEntry=e.onEntry?[].concat(e.onEntry):void 0,this.onExit=e.onExit?[].concat(e.onExit):void 0,this.data=e.data,this.activities=e.activities}return t.prototype.getStateNodes=function(t){var e=this,n=t instanceof p?t.value:a(t,this.delimiter);if("string"==typeof n){var i=this.getStateNode(n).initial;return i?this.getStateNodes((o={},o[n]=i,o)):[this.states[n]]}var r=Object.keys(n);return r.map(function(t){return e.getStateNode(t)}).concat(r.reduce(function(t,i){var r=e.getStateNode(i).getStateNodes(n[i]);return t.concat(r)},[]));var o},t.prototype.handles=function(t){var e=i(t);return-1!==this.events.indexOf(e)},t.prototype.transition=function(t,e,n){var r="string"==typeof t?this.resolve(o(this.getResolvedPath(t))):t instanceof p?t:this.resolve(t);if(this.strict){var a=i(e);if(-1===this.events.indexOf(a))throw new Error("Machine '"+this.id+"' does not accept event '"+a+"'")}var s=p.from(r),c=this.transitionStateValue(s,e,s,n),u=this.stateTransitionToState(c,s);if(!u)return p.inert(s);var f=u,h=u.actions.filter(function(t){return"object"==typeof t&&t.type===E.raise});if(h.length){var l=h[0].event;return u=this.transition(u,l,n),(y=u.actions).unshift.apply(y,u.actions),u}if(c.events.length){var v=c.events[0].type===E.raise?c.events[0].event:void 0,d=c.events[0].type===E.null;if(v||d)return f=this.transition(u,d?"":v,n),(g=f.actions).unshift.apply(g,u.actions),f}return u;var y,g},t.prototype.stateTransitionToState=function(t,e){var n=t.statePaths,i=t.actions,r=t.activities,a=t.events;if(n.length){var o=e instanceof p?e.activities:void 0,s=N({},o,r),c=this.resolve(g(n));return new p(c,p.from(e),i?i.onExit.concat(i.actions).concat(i.onEntry):[],s,this.getStateNodes(c).reduce(function(t,e){return void 0!==e.data&&(t[e.id]=e.data),t},{}),a)}},t.prototype.getStateNode=function(t){if(V(t))return this.machine.getStateNodeById(t);if(!this.states)throw new Error("Unable to retrieve child state '"+t+"' from '"+this.id+"'; no child states exist.");var e=this.states[t];if(!e)throw new Error("Child state '"+t+"' does not exist on '"+this.id+"'");return e},t.prototype.getStateNodeById=function(t){var e=V(t)?t.slice("#".length):t,n=this.idMap[e];if(!n)throw new Error("Substate '#"+e+"' does not exist on '"+this.id+"'");return n},t.prototype.resolve=function(t){var e=this;if("string"==typeof t){var n=this.getStateNode(t);return n.initial?(i={},i[t]=n.initialStateValue,i):t}return this.parallel?s(this.initialStateValue,function(n,i){return e.getStateNode(i).resolve(t[i]||n)}):s(t,function(t,n){return e.getStateNode(n).resolve(t)});var i},t.prototype.transitionStateValue=function(t,e,n,i){var r=this,a=t.history,o=t.value;if("string"==typeof o){var c=this.getStateNode(o),u=c.next(e,n,a?a.value:void 0,i);return u.statePaths.length||this.parent?u:this.next(e,n,a?a.value:void 0,i)}var f=[],h=!1,l=s(o,function(t,o){var s=r.getStateNode(o),c=a?a.value[o]:void 0,u=new p(t,c?p.from(c):void 0),l=s.transitionStateValue(u,e,n,i);return l.statePaths.length?h=!0:f.push(s.next(e,n,a?a.value:void 0,i)),l});if(!h){if(this.parallel)return f.length?f[0]:{statePaths:[],actions:A,activities:void 0,events:[]};var v=Object.keys(l)[0],d=this.getStateNode(v).next(e,n,a?a.value:void 0,i),g=d.statePaths,E=d.actions,b=d.activities,m=l[v].actions,S=l[v].activities,x=N({},S,b);return{statePaths:g,actions:E?m?{onEntry:m.onEntry.concat(E.onEntry),actions:m.actions.concat(E.actions),onExit:m.onExit.concat(E.onExit)}:E:m,activities:x,events:[]}}this.parallel&&(l=N({},s(this.initialState.value,function(t,e){var n=l[e];return{statePaths:n&&n.statePaths.length?n.statePaths:y(o[e]||t).map(function(t){return r.getStateNode(e).path.concat(t)}),actions:n&&n.actions?n.actions:{onEntry:[],onExit:[],actions:[]},activities:void 0,events:[]}})));var w={onEntry:[],actions:[],onExit:[]},j={};return s(l,function(t){var e=t.actions,n=t.activities;e&&(e.onEntry&&(i=w.onEntry).push.apply(i,e.onEntry),e.actions&&(r=w.actions).push.apply(r,e.actions),e.onExit&&(a=w.onExit).push.apply(a,e.onExit)),n&&Object.assign(j,n);var i,r,a}),{statePaths:Object.keys(l).map(function(t){return l[t].statePaths}).reduce(function(t,e){return t.concat(e)},[]),actions:w,activities:j,events:[]}},t.prototype.next=function(t,e,n,r){var o=this,s=i(t),u={onEntry:[],onExit:[],actions:[]},f={},h=this.on[s];if(this.onExit&&(u.onExit=this.onExit),this.activities&&this.activities.forEach(function(t){f[i(t)]=!1,u.onExit=u.onExit.concat(P(t))}),!h)return{statePaths:[],actions:u,activities:f,events:[]};for(var l=[],v=0,p=h;v<p.length;v++){var g=p[v],b=g,S=b.cond,x=b.in,w=b.actions,j=r||{},O=m(t),N=!x||c(a(x,this.delimiter),d(this.path.slice(0,-2))(e.value));if((!S||S(j,O))&&(!x||N)){l=Array.isArray(g.target)?g.target:[g.target],w&&(u.actions=u.actions.concat(w));break}}if(0===l.length)return{statePaths:[],actions:u,activities:f,events:[]};var _=[],A=[],M={};return l.forEach(function(e){var r=o.getResolvedPath(e),a=V(e)?o.machine:o.parent,s=n,c=o.key;if(r.forEach(function(e){if(""===e)return u.onExit=[],void(a=o);if(!a||!a.states)throw new Error("Unable to read '"+e+"' from '"+o.id+"'");if("$history"===e)if(Object.keys(a.states).length)if(s)e="object"==typeof s?Object.keys(s)[0]:s;else{if(!a.initial)throw new Error("Cannot read '$history' from state '"+a.id+"': missing 'initial'");e=a.initial}else e="";try{""!==e&&(a=a.getStateNode(e))}catch(e){throw new Error("Event '"+t+"' on state '"+c+"' leads to undefined state '"+r.join(o.delimiter)+"'.")}a.onEntry&&(u.onEntry=u.onEntry.concat(a.onEntry)),a.activities&&a.activities.forEach(function(t){f[i(t)]=!0,u.onEntry=u.onEntry.concat(k(t))}),c=e,s&&(s=s[e])}),!a)throw new Error("no state");for(var h=T(o,t,M,a);h.parent;)h=T(o,t,M,h.parent);var l=[a.path];if(a.initial||a.parallel){var v=a.initialState;u.onEntry=u.onEntry.concat(v.actions),l=y(v.value).map(function(t){return a.path.concat(t)})}for(_.push.apply(_,l);a.initial;){if(!a||!a.states)throw new Error("Invalid initial state");a=a.states[a.initial],a.activities&&a.activities.forEach(function(t){f[i(t)]=!0,u.onEntry=u.onEntry.concat(k(t))})}(a.onEntry?a.onEntry.filter(function(t){return"object"==typeof t&&t.type===E.raise}):[]).concat(a.on[""]?{type:E.null}:[]).forEach(function(t){return A.push(t)})}),{statePaths:_,actions:u,activities:f,events:A}},Object.defineProperty(t.prototype,"resolvedStateValue",{get:function(){var t=this.key;return this.parallel?(e={},e[t]=s(this.states,function(t){return t.resolvedStateValue[t.key]}),e):this.initial?(n={},n[t]=this.states[this.initial].resolvedStateValue,n):t;var e,n},enumerable:!0,configurable:!0}),t.prototype.getResolvedPath=function(t){if(V(t)){var e=this.machine.idMap[t.slice("#".length)];if(!e)throw new Error("Unable to find state node '"+t+"'");return e.path}return r(t,this.delimiter)},Object.defineProperty(t.prototype,"initialStateValue",{get:function(){var t=this.__cache.initialState||(this.parallel?s(this.states,function(t){return t.initialStateValue}):"string"==typeof this.resolvedStateValue?void 0:this.resolvedStateValue[this.key]);return this.__cache.initialState=t,this.__cache.initialState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initialState",{get:function(){var t=this.initialStateValue;if(!t)throw new Error("Cannot retrieve initial state from simple state '"+this.id+".'");var e={},n=[];return this.getStateNodes(t).forEach(function(t){t.onEntry&&n.push.apply(n,t.onEntry),t.activities&&t.activities.forEach(function(t){e[i(t)]=!0,n.push(k(t))})}),new p(t,void 0,n,e)},enumerable:!0,configurable:!0}),t.prototype.getStates=function(t){var e=this;if("string"==typeof t)return[this.states[t]];var n=[];return Object.keys(t).forEach(function(i){n.push.apply(n,e.states[i].getStates(t[i]))}),n},t.prototype.getState=function(t){if("string"==typeof t&&V(t))return this.getStateNodeById(t);var e=r(t,this.delimiter);try{return e.reduce(function(t,e){if(!t.states)throw new Error("Cannot retrieve subPath '"+e+"' from node with no states");return t.states[e]},this)}catch(e){throw new Error("State '"+t+" does not exist on machine '"+this.id+"'")}},Object.defineProperty(t.prototype,"events",{get:function(){if(this.__cache.events)return this.__cache.events;var t=this.states,e=new Set(Object.keys(this.on));return t&&Object.keys(t).forEach(function(n){var i=t[n];if(i.states)for(var r=0,a=i.events;r<a.length;r++){var o=a[r];e.add(""+o)}}),this.__cache.events=Array.from(e)},enumerable:!0,configurable:!0}),t.prototype.formatTransitions=function(t){return s(t,function(t){return void 0===t?[]:Array.isArray(t)?t:"string"==typeof t?[{target:t}]:Object.keys(t).map(function(e){return N({target:e},t[e])})})},t}();n.d(e,"Machine",function(){return f}),n.d(e,"StateNode",function(){return I}),n.d(e,"State",function(){return p}),n.d(e,"matchesState",function(){return c}),n.d(e,"mapState",function(){return u}),n.d(e,"actions",function(){return h})}])});